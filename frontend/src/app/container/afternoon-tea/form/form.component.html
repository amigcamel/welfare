<div class="container" fxLayout="column">
  <div>
    <div class="title-group" fxLayout="row" fxLayoutAlign="space-between center">
      <div fxLayout="column" fxLayoutAlign="center start">
        <div fxLayout="row" fxLayoutAlign="start center">
          <mat-icon>home</mat-icon>
          <mat-icon>chevron_right</mat-icon>
          <span>Afternoon tea</span>
        </div>
        <div>SLEEP 5 MIN</div>
      </div>
      <div *ngIf="!!expiration" fxLayout="column" fxLayoutAlign="center start" fxFlex="40">
        <div class="count-down-item">Expiration: </div>
        <div fxLayout="row" fxLayoutAlign="space-around center">
          <div class="count-down-item">{{this.expiration.days}} Days </div>
          <div class="count-down-item">{{this.expiration.hours}} Hours </div>
          <div class="count-down-item">{{this.expiration.minutes}} Minutes </div>
          <div class="count-down-item">{{this.expiration.seconds}} Seconds</div>
        </div>
      </div>
    </div>
  </div>
  <div>
    <div *ngIf="!!formData?.update_time">
      Last edited: {{formData['update_time']}}
    </div>
    <div class="form" fxLayout="column">
      <mat-vertical-stepper [linear]="true">
        <mat-step *ngFor="let form of formData?.form; let i = index">
          <ng-template matStepLabel>
            <div fxLayout="row" fxLayoutAlign="start center">
              <h1>
                {{form.formLabel}}
              </h1>
              <mat-icon (click)="seeMenu(form.menuImage)" style="width: 24px !important; height: 24px !important;">search</mat-icon>
            </div>
          </ng-template>
          <div class="filter-bar" fxLayout="row" fxLayoutAlign="starter center">
            <input placeholder="Search item" type="text" fxFlex [(ngModel)]="filterTarget">
            <mat-icon>search</mat-icon>
          </div>
          <div *ngFor="let item of form.items">
            <ng-container *ngIf="filterText(item.itemLabel)">
              <div fxLayout="column" class="item" [ngClass]="{'active': item.value > 0}" [@openClose]="item.collapse ? 'open' : 'closed'">
                <div>
                  <div class="item-title" fxLayout="row" (click)="toggleCollapse(item)">
                    <div class="item-label" fxLayout="rows" fxLayoutAlign.gt-sm="space-between space-between" fxLayoutAlign.xs="space-between center">
                      <span class="item-title-label">{{item.itemLabel}}</span>
                      <span class="item-price-label">
                        ({{getPriceLabel(item)}})
                      </span>
                    </div>

                    <div class="control-bar" fxLayout="row" fxLayoutAlign="space-around center">
                      <mat-icon class="button" (click)="subOnFlow(form, item, $event);" style="width: 32px; height: 32px">remove</mat-icon>
                      <div class="item-value">{{item.value}}</div>
                      <mat-icon class="button" (click)="addOneFlow(form, item, $event);" style="width: 32px; height: 32px">add</mat-icon>
                    </div>
                  </div>
                  <ng-container *ngFor="let option of item.options">
                    <ng-container *ngIf="!!option.radioSelections && option.radioSelections.length > 0">
                      <ng-container *ngIf="layoutConfigService.isDesktop$ | async; else mobile">
                        <div class="option" fxLayout="row" fxLayoutAlign="start center">
                          <div class="option-title">{{option.optionLabel}}:</div>
                          <mat-radio-group fxLayoutAlign="space-between center" [(ngModel)]="item.selections[option.optionKey]" (change)="calculatorSum()" fxFlex="100">
                            <mat-radio-button  *ngFor="let select of option.radioSelections" [value]="select.value" >{{select.selectionLabel}}</mat-radio-button>
                          </mat-radio-group>
                        </div>
                      </ng-container>
                      <ng-template #mobile>
                        <div class="option" fxLayout="row" fxLayoutAlign="start center">
                          <div class="option-title">{{option.optionLabel}}:</div>
                          <mat-select [(ngModel)]="item.selections[option.optionKey]" (change)="calculatorSum()">
                            <mat-option *ngFor="let select of option.radioSelections" [value]="select.value">
                              {{select.selectionLabel}}
                            </mat-option>
                          </mat-select>
                        </div>
                      </ng-template>
                    </ng-container>
                    <ng-container *ngIf="!!option.checkBoxOptions && option.checkBoxOptions.length > 0">
                      <div class="option" fxLayout="row" fxLayoutAlign="start center">
                        <div class="option-title">{{option.optionLabel}}:</div>
                        <div class="selection">
                          <div *ngFor="let select of option.checkBoxOptions" fxLayoutAlign="space-between center" fxFlex="100">
                            <mat-checkbox [checked]="select.choose" (change)="checkedOption(select)">{{select.selectionLabel}}</mat-checkbox>
                          </div>
                        </div>

                      </div>
                    </ng-container>
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </div>
          <div fxLayout="row" fxFlex="100" fxLayoutAlign="space-around center">
            <button mat-raised-button matStepperPrevious (click)="closeAllCollapse(form)">previous</button>
            <button *ngIf="!form.isEnd" mat-raised-button matStepperNext (click)="closeAllCollapse(form)">next</button>
            <button *ngIf="form.isEnd" mat-raised-button type="button" color="accent" (click)="finishOrder()">
              Finish
            </button>
          </div>
          <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
            <div></div>
            <div fxLayout="row">
              <mat-icon>attach_money</mat-icon>
              <div>Total: {{sum}}</div>
            </div>
          </div>
        </mat-step>
      </mat-vertical-stepper>
    </div>
  </div>
</div>
